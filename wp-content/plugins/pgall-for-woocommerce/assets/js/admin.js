jQuery(document).ready(function(a){"use strict";var b=a("[id^=pafw-order].postbox"),c=function(){return b.is(".processing")||b.parents(".processing").length},d=function(){c(b)||b.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},e=function(){b.removeClass("processing").unblock()};({init:function(){a("#pafw-refund-request").on("click",this.refund_request),a("#pafw-repay-request").on("click",this.reqay_request),a("#pafw-check-receipt").on("click",this.check_receipt),a("#pafw-escrow-register-delivery-info").on("click",{escrow_type:"I"},this.escrow_register_delivery_info),a("#pafw-escrow-modify-delivery-info").on("click",{escrow_type:"U"},this.escrow_register_delivery_info),a("#pafw-escrow-approve-reject").on("click",this.escrow_approve_reject),a("#pafw-vbank-refund-request").on("click",this.vbank_refund_request),a("#pafw-subscription-additional-charge").on("click",this.subscription_additional_charge),a("input.pafw-subscription-cancel-additional-charge").on("click",this.subscription_cancel_additional_charge),a("#pafw-cancel-batch-key").on("click",this.cancel_batch_key)},refund_request:function(){if(!c()){var b={action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce,payment_action:"refund_request"};confirm("전체취소를 진행하시겠습니까?\n주문건의 전체항목이 취소가 됩니다.")&&(d(),a.post(ajaxurl,b,function(a){a?"true"==a.success||a.success?(alert(a.data),location.reload()):alert(a.data):alert("전체취소 요청 결과를 수신하지 못하였습니다.\n처리 결과 확인을 위해 영수증을 확인해 보시기 바랍니다."),e()}))}},reqay_request:function(){if(!c()){var b={action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,amount:a("#repay_price").val(),_wpnonce:_pafw_admin._wpnonce,payment_action:"repay_request"};confirm("부분취소처리를 진행하시겠습니까?\n\n1) 부분취소는 매입후 취소이기 때문에 당일 처리가 되지 않습니다.\n2) 부분취소 처리를 한 경우 전체 금액 취소가 불가능하며, 남은잔액을 모두 입력하여 취소 처리만 가능합니다.\n\n - 취소 요청 금액 : "+jQuery("#repay_price").val())&&(d(),a.post(ajaxurl,b,function(a){a?a.success?(alert(a.data),location.reload()):(alert(a.data),e()):(alert("부분취소 처리결과를 수신하지 못하였습니다.\n처리 결과 확인을 위해 영수증을 확인해 보시기 바랍니다."),e())}))}},check_receipt:function(){var a="",b="";_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.name)||(a=_pafw_admin.receipt_popup_params.name),_.isEmpty(_pafw_admin.receipt_popup_params)||_.isEmpty(_pafw_admin.receipt_popup_params.features)||(b=_pafw_admin.receipt_popup_params.features),window.open(_pafw_admin.receipt_url,a,b)},escrow_register_delivery_info:function(b){var c=a("#pafw-order-escrow #tracking_number").val();if(""===c)return void alert("송장번호를 입력해주세요.");confirm("배송 정보를 등록하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,order_id:_pafw_admin.order_id,tracking_number:c,_wpnonce:_pafw_admin._wpnonce,escrow_type:b.data.escrow_type,payment_action:"escrow_register_delivery_info"},success:function(a){a.success?(alert("배송정보 등록이 완료되었습니다.\n\n고객님께 물품 수령후에 에스크로 구매확인 및 거절 의사를 표시 요청을 하셔야 합니다."),window.location.reload()):(alert("관리자에게 문의하여주세요.\n\n에러 메시지 : \n"+a.data),e())}}))},escrow_approve_reject:function(){confirm("정말 환불 처리하시겠습니까?\n\n처리 이후에 이전 상태로 되돌릴 수 없습니다. 신중하게 선택해주세요.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"escrow_approve_reject",order_id:_pafw_admin.order_id,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},vbank_refund_request:function(){var b=a("#vbank_refund_bank_code").val(),c=a("#vbank_refund_acc_num").val(),f=a("#vbank_refund_acc_name").val(),g=a("#vbank_refund_reason").val();""===b?alert("환불 은행을 선택해주세요."):""===c?alert("환불 계좌번호를 입력해주세요."):""===f?alert("환불 계좌주명을 입력해주세요."):confirm("정말 환불 처리하시겠습니까?\n\n처리 이후에 이전 상태로 되돌릴 수 없습니다. 신중하게 선택해주세요.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"vbank_refund_request",order_id:_pafw_admin.order_id,refund_bank_code:b,refund_acc_num:c,refund_acc_name:f,refund_reason:g,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},subscription_additional_charge:function(){var b=0|parseInt(a("#subscription_additional_charge_amount").val());b<=0?alert("추가 과금 요청 금액을 입력해주세요."):confirm("추가 과금을 요청하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_additional_charge",order_id:_pafw_admin.order_id,amount:b,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},subscription_cancel_additional_charge:function(){var b=a(this).data("tid"),c=a(this).data("amount");confirm("추가 과금을 취소하시겠습니까?")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_cancel_additional_charge",order_id:_pafw_admin.order_id,tid:b,amount:c,_wpnonce:_pafw_admin._wpnonce},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))},cancel_batch_key:function(){var b=a(this).closest("div").find("#subscription_batch_key").val();if(_.isEmpty(b))return void alert("비활성화할 배치키를 입력해주세요.");confirm("[주의] 정기결제 배치키를 비활성화 하시겠습니까? 비활성화된 정기결제 배치키는 다시 활성화하실 수 없습니다.")&&(d(),a.ajax({url:ajaxurl,type:"POST",data:{action:_pafw_admin.slug+"-pafw_ajax_action",payment_method:_pafw_admin.payment_method,payment_action:"subscription_cancel_batch_key",subscription_id:_pafw_admin.subscription_id,batch_key:b},success:function(a){a.success?(alert(a.data),window.location.reload()):(alert(a.data),e())}}))}}).init()});